# 파이썬 서버 설치하기
ec2에 파이썬 서버 올리기.
생각보다 도커파일을 다루는 게 잘 안 된다
poetry의 명령어를 제대로 인식하지 못하는 문제도 있는 것으로 보인다.
![[Pasted image 20240325101409.png]]
이런 식으로 다루고 있는데, 아랫줄을 실행하면 manage.py가 없다고 나오고 윗줄을 실행하면 shell이 없다고 나온다.. 뭐 어쩌라는 건지;

해결책은 찾았다. copy를 할 때 디렉토리 단위로 가져오지 않아 안 속에 파일들이 흩뿌려진 게 화근이었다.
workdir를 루트로 바꾸자 문제는 해결됐다.
![[Pasted image 20240325103747.png]]
그러나 아직 문제는 남아있다.
컨테이너 안에 들어가서 파이썬 서버가 살아있는지 확인은 충분히 가능한데, 왜 ec2 밖에서는 요청이 들어가지 못하는 걸까?
문제를 해결해나가는 과정. 기본적으로 django는 로컬호스트의 요청만 받도록 되어 있어 모든 주소에서 올 수 있도록 풀어줘야 한다. 
![[Pasted image 20240325104320.png]]
그래도 문제는 남아있다. 이러면 allowed hosts를 또 풀어줘야 한다.
실제로는 백 서버로만 쓸 거니까 우리 주소만 적어주면 될 것이라 생각된다.
![[Pasted image 20240325112918.png]]
최종적으로 만든 도커파일은 이렇게 된다.
poetry를 넣어둔 도커 이미지가 따로 없어 이렇게 귀찮게 만들어야 하긴 하는데, 그래도 한번 쓰기만 하면 크게 어려운 점은 없다는 점이 또 장점.
비효율적으로 이미지가 쌓이는 것을 방지하기 위해 순서도 조정했다. 


# 파이썬 버전 변경
초기에는 gpu 서버를 활용하기로 마음을 먹었기 때문에 gpu에 깔린 파이썬 3.9를 활용할 생각이었다.
그러나 계획이 무산되고, gpt4의 기능을 사용하기 위해서 최소 3.10의 파이썬 버전을 사용해야 한다는 이야기를 들었다. 
그래서 버전을 변경하고 서버를 다시 구축할 계획을 세우는 중이다.

```bash
apt insall python3.9
```
간단하게 3.9버전은 다운 받을 수 있었으나, 아무래도 기본 패키지에서는 파이썬 3.12를 제공하지 않는 듯하다.

그렇다면 역시 pyenv를 다시 한번만 더 파보자.
![[Pasted image 20240325125907.png]]
이런 에러들이 자잘하게 뜨는데, 이것들을 위해 의존성 처리를 해줘야 하는 것들이 있는 모양이다. 
```bash
apt install libbz2-dev
```
하나씩 에러를 해결해나가보자. 
```
apt install -y build-essential libssl-dev zlib1g-dev \
libbz2-dev libreadline-dev libsqlite3-dev curl \
libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev
```
이미 다른 글들에서도 이러한 문제를 겪은 케이스가 존재하는 모양이다.
개인적으로 이렇게 의존성 문제가 많다면 이것은 pyenv를 만든 사람들이 잘 캐치를 하는 게 바람직할 것이라 생각한다.
https://github.com/pyenv/pyenv/wiki#suggested-build-environment
이렇게 깃헙 위키를 참고해서 의존되는 환경을 설치하는 것은 좋지 않은 것 같은데..
왜 이렇게 해둔 것일까? 여력이 된다면 제안을 해보고 싶다. 
![[Pasted image 20240325132443.png]]
심지어 제안한 것을 그대로 했는데도 문제가 발생한다.
다른 글에 있는 것으로 설치를 할 때 계속 의존성 문제가 발생했다.
실수로 공식 문서에 나온 의존성을 전부 설치하지 않은 것이다.
이렇게 전부 내가 직접 전부 깔도록 하는 것이 맞나 싶다. 