# 도커 설치 및 도커 컴포즈 사용
도커 사용하는 방법이 익숙해 도커 컴포즈도 금방 적응하겠거니 안일한 생각을 가지고 있었는데, 생각보다는 조금 어려운 측면이 있다.
그래도 이 정도면 충분히 커버 가능한 범주의 느낌이다.
다만 내가 빨리 작업을 끝내야 다른 팀원들이 서버를 사용할 수 있다는 생각에 계속 조마조마하다.![[Pasted image 20240310202618.png]]
도커를 점점 사용하면 할수록 몰랐던 것이 보이기 시작한다. 
https://danawalab.github.io/docker/2021/01/13/docker-compose-guideline.html
# 스터디
## AES
Plain Text를 위치만 계속 바꾸는 라운드를 거침
그러면 결국 원래 데이터가 가진 문자들을 전부 가지고 있다는 것.
비선형변환이 들어가는 것인가? 어디가 비선형일까. 선형이면 결국 한번의 계산으로 치환될텐데
서브워드가 뭔데 정확하게 비선형성을 가질까 - 테이블을 사용해서 고치는 것.

## RSA
암호화에서는 수신자의 비밀키와 공개키? 이게 무슨 말인가?
디지털 서명에서는 송신자의 비밀키와 공개키?

## 디피 헬만

케르베로스 프로토콜에서 타임스탬프가 어떤 식으로 유효하게 작동하는지 잘 이해가 안됌
kdc와 ca는 다른 건가? 어떤 관계인 것인가?

# 전략 고민
나이브한 생각으로는 도커파일과 도커 컴포즈로 모든 것을 관리할 수 있을 것이라고 봤다.
근데 공부를 하면서 생각해보니 블루그린을 통한 무중단 배포를 달성하는데 있어서 도커 컴포즈가 제약사항이 되지 않을까 하는 생각이 들기 시작했다.
- 도커 컴포즈는 기본적으로는 한 파일만 작성하는 게 낫다고 본다. 
	- 각 컴포즈 파일을 두고 관리하게 될 경우 항상 컴포즈 파일의 경로를 명시해서 관리해야 하는데 이는 의도된 방식은 아닌 것 같다.
	- 너무 나뉘어져 있어도 다루기 쉬울 것 같지는 않다.
- 한 파일에만 작성한다면, 어떻게 블루그린을 할 것인가?
	- 나는 서버 단위 별로 블루 그린을 적용시킬 생각이었다. 

## 현재 생각
- 느징스
	- port.inc를 두고 이 파일의 값에 블루=이전포트, 그린=새포트 값을 넣는다. 이것만 매번 바꿔주는 스크립트 짠다
- 도커컴포즈
	- 환경변수는 up되는 시점에만 사용되기에 한 도커 컴포즈로 모든 것을 사용하기는 힘들 것 같다.
	- 블루, 그린 값을 변수로 쓰는 쉘 스크립트를 짠다
	- 두 개의 도커 컴포즈를 둔다. 
	- 각 컴포즈파일을 매번 블루, 그린으로 정의하면서 바꿔친다.
	- 아마 컴포즈 파일이름에는 포트 번호가 들어가야 할 것 같다. 

이렇게 되면 무조건 도커파일을 쓸 수밖에 없는 것 같다. 같은 이미지가 필요하기 때문.
사실 무조건까지는 아니긴 하다. 이미지만 있으면 되는 것이고, 필요한 파일의 경우에는 scp를 사용하던가 해서 런타임 이내에 옮기는 것이 충분히 가능하다. 
https://hackerpark.tistory.com/entry/Docker-Dockerfile%EC%9D%98-%EA%B5%AC%EC%A1%B0%EC%99%80-%EB%AC%B8%EB%B2%95

만약 그린을 배포하다 실패했다고 치자. 
그럼 현재 가동 중인 녀석이 그린인지 블루인지 어떻게 알 수 있는가? 그걸 알 수 있는 정보가 필요하다.
도커 컴포즈는 up되면 새로 이름을 바꾸는 건 불가능하다. 컨테이너 이름 역시 재시작하지 않고는 이름을 바꿀 수 없다.
그렇다면 그냥 내가 블루랑 그린의 이름을 명확히 알려주는 수밖에 없다. 
매번 실행되고 있는 녀석은 그린이 될 것이다.
배포가 되는 순간 그린을 블루로 바꾼다. 그리고 새 그린을 세운다.
만약 새 그린이 실행되지 않았다면 블루가 남아있을 것이고, 이는 배포가 실패했다는 것을 의미한다. 그게 아니라면 그린이 실행되고 있을 것이다.
새로운 배포를 하는 관점에서 바라보는 것이 중요하다.
그래서 항상 배포되고 있는 것은 그린이라 친다.
블루라 보는 게 더 타당한가? 아니다. 블루는 무중단 배포를 하는 시점에 이전 버전일 뿐이다.