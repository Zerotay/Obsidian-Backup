# fasttext 성공?
[[24.03.26#fasttext]]
어제 신나게 설치 실패해서 고통 받던 그것.
정확하게 어떤 것으로 해결됐는지는 확실하지 않다.
다만
```
poetry add fasttext-wheel
```
이게 해결점이었던 것 같기도 하다.
이것에 c++ 버전을 잘 설치한 것까지 해서 에러를 해결할 수 있었던 것으로 생각된다. 
그래서 이건 다른 환경에서 다시 테스트 해볼 필요가 있다는 것만 짚어두고 가겠다. ![[Pasted image 20240327092322.png]]
일단은 잘 동작한다!
내가 도전해본 것들
- poetry에서 깃으로 설치
- pip로 설치
- wheel 설치
- gcc버전 명시해서 설치
	- 컴파일 위해 c++ 설치
- fasttext-wheel 설치

이 중에서 wheel은 그냥 설치가 가능했고, c++도 설치가 가능했다.
나머지는 전부 같은 에러를 띄웠다. 

# fasttext 활용
https://github.com/facebookresearch/fastText/issues/1065
![[Pasted image 20240327111954.png]]
겨우겨우 잘 받아서 활용을 해보려는데, 데이터를 제대로 디코딩하지 못하는 문제가 있었다.
위의 해결법으로 잘 해결이 가능했다.

![[Pasted image 20240327113415.png]]
확인해보니 모델이 잘 불러와졌다. 
이제는 이 모델을 저장하고 서버의 디스크에 할당한다. 
이후에는 이를 활용해 서버가 동작하게 하면 된다.


# 매칭 서버 구동
백엔드 팀원의 요청에 따라 매칭 로직을 구성하는 작업을 진행해보자.
활용할 매칭 요소.
1. 색깔 - 0.2
2. 위치 0. 3
3. 물품명 - 0.3
4. 설명 - .02
5. 날짜 0.1
이 중에서 내가 먼저 할 것은? 설명에 대해서 유사도 구하기


설명에 있는 것들을 일단 형태소 분석을 진행한다.
분석을 한 이후에는 fasttext에 우겨 넣어 임베딩을 구한다. 
![[Pasted image 20240327135914.png]]
물품명에 띄어쓰기가 들어가면 결과가 상당히 오묘해진다.
![[Pasted image 20240327140047.png]]
차라리 

# 서버 간 통신 문제 - PIKX
https://www.lesstif.com/java/java-pkix-path-building-failed-98926844.html
현재 서버에서 이러한 문제가 발생하고 있다.
정확하게 말하면 배포 서버 간 문제가 발생하고 있는지는 확인을 아직 하지 못했지만, 개발자의 로컬의 메인 서버와 원격의 배치 서버가 통신하지 못하고 있는 상황이다.
그 원인은 SSL과 관련되어 있다.
프록시 서버를 거치면 SSL이 자동으로 적용되는데, 이때 문제가 발생한다는 것이다.

문제는 ssl 인증서에 대해 jvm이 정보를 가지고 있지 않다는 것에 기인한다. 
신뢰할 수 없는 ssl이니까 받지 않겠다고 하는 격인데, 이를 해결하기 위해서는 jvm이 구동될 때 이를 신뢰할 수 있도록 해주면 된다.

이건 결국 서버에 위치한 jvm에 대해서도 같은 문제를 야기할 것이다.
일단 내 로컬에서 배치 서버로의 연결을 시도해보자.

![[Pasted image 20240327204915.png]]
백엔드 팀원의 도움으로 쉽게 로컬에 서버를 띄우는 것에 성공했고, 어떻게 에러가 뜨는지도 확인 가능했다. 그럼 이제부터는 인프라가 빛을 발할 시간이다. ![[Pasted image 20240327204904.png]]
차근히 진행해본다.
![[Pasted image 20240327205100.png]]
두번째 뜨는 값이 jvm에 넣어주어야할 인증서라고 한다.
```bash
keytool -exportcert -keystore jssecacerts -storepass changeit -file output.cert -alias lesstif.com-
```
이걸 실행해준다. 
접속하고자 하는 사이트의 인증서를 확인하고, 이걸 keytool을 통해 jvm에 이식해준다는 뜻으로 해석했다.
```bash
sudo  keytool -importcert -keystore ${JAVA_HOME}/lib/security/cacerts -storepass changeit -file output.cert -alias letsencrypt
```
이것까지 해주어야만 한다.
정확하게 위에서는 export를 시켰고, 그것을 java에 등록해주는 과정을 거치는 것이다.
![[Pasted image 20240327210156.png]]
JAVA_HOME이 변수에 등록되어 있지 않은 관계로 다음의 설정을 해주었다.
![[Pasted image 20240327210444.png]]
아잇 킹받게.. 그냥 영어로 해라..
![[Pasted image 20240327210914.png]]
![[Pasted image 20240327210921.png]]
성공한 것으로 보인다.

이제 이게 완료된 것이라면, 도커파일에도 이에 해당하는 수정을 해줄 필요가 있다.
그런데 여기에서는 대화형으로 설정을 했는데 이걸 어떻게 도커파일에 녹일 수 있을까?
https://cheershennah.tistory.com/143
결국 요지는, 인증서를 자알 받아와서 그것을 자바의 security 폴더에 녹여내는 것.


라고 생각하고 열심히 도전을 해봤지만, 일단 실패했다.
jre 환경 컨테이너를 사용하는데 여기에는 윈도우와 같은 경로가 존재하지 않았다. lib 어딨어..
security 디렉토리는 있는데 여기에 무슨 짓을 해야 하는 것일까.
![[Pasted image 20240327234741.png]]
안 된다고 해서 포기할 나는 아니다. 
그렇다면 no prompt 옵션으로 keystore에 올리는 작업을 자동화한다.
그러나 아직 해결은 되지 않았다. 제대로 keystore을 지정한 게 맞는 것일까?
자바를 실행할 때 환경변수를 전달하는 것이 가능하다.
그렇다면 그것으로 keystore 위치를 명시해보자.
