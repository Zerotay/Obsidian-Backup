# 캐싱
고품질을 위해. 
성능, 안정성, 보안
성능이 높아질수록 안정성은 떨어진다.

- 브라우저 단위의 캐시
	- 이미지 등의 정적 리소스 대상
	- 서버의 리소스가 실시간으로 반영되진 않음
- 응답 지연 값
	- 일반적인 io에서... 읽는 속도는 메모리가 압도적으로 빠름

# 엘라스틱 서치
![[Pasted image 20240315121401.png]]
그제 있었던 이슈. 컨테이너를 세워도 제대로 유지되지 않았다. 
궁금해서 log를 꺼내보니 다음과 같은 메시지를 볼 수 있었다.
root 계정으로 하지 말라는 것. 
![[Pasted image 20240315121449.png]]
그래서 이렇게 바꿔줬더니 일단 잘 돌아간다!

다음 이슈는 내가 설치한 버전. 나는 가장 최신 버전인 8.12.2
7.17.3으로 버전을 맞춰야 스프링 부트 버전과 배치 버전과 호환되게 만들 수 있다. 
현재 팀에서 사용하는 스프링부트는 2.7x이다. 3으로 넘어갈 경우에는 문제 없이 엘서를 8로 사용할 수 있을 것으로 생각되나.
![[Pasted image 20240315122846.png]]
성공. 8버전은 무조건 ssl로 연결해야 한다는 번거로움까지 있다. 그러나 7의 경우는 그럴 필요가 없어서 최소한 연결하는 입장에서는 조금 더 편리하다.
물론 그렇다해도 ssl 터미네이션시키면 돼서 걱정은 없긴 하다. 

이 친구도 디비 역할을 하기에 논리 볼륨을 만들어줄 필요가 있다.






# 클라우드 강의

kubelet이 노드 속 레지스트리..?
도커 빌드는 캐싱이 되던데, copy 같은 명령어의 수정사항은 어떻게 반영이 되는가? 알아서 파일의 변경 사항을 어떻게 알아채는가?

오늘은 디플로이먼트 객체와 서비스 객체 생성할 것이다.
쿠버에 필요한 요소는 미리 선언만 하면 된다. yaml. 이걸 보통 manifest라고 한다.
가능하면 쿠버는 선언적으로 동작시키는 게 좋다.

디플로이먼트는 그 아래 레플리카셋. 그 아래로 3개의 파드가 있다.

파드들은 각자 같은 일한다. 그러니 이들을 같은 동작을 처리하기에 이를 해결하는 네트워크 필요.
로드밸런싱!

파드는 각자가 하나의 호스트라 생각하면 쉽다. 각자 고유한 ip를 할당받는다.
파드가 할당될 ip를 줄 풀이 필요하다. 

디플 객체를 만들 때 kind에 deployment라 정의한다.
안에 spec에는 replica는 3개를 하도록
그 안 템플릿에 또 비슷한 형시긍로
거기에는 labels를 지정한다.
template안 spec에 제대로 컨테이너를 지정

레플리카셋에 정의된 내용으로 알아서 늘렸따 줄였따 한다. 이걸 hpa라고 한다. 
최소값, 최대값
replicas는 replicaset의 복제 수이다.
replicaset은 늘었따 줄었따 한다. 몇개의 복제본을 가질거냐 이런 얘기

gui로도 가능하다. 
gui를 먼저 실습하자.
개념 설명하고 겹쳐서

gui로 만들 때 yml 확인 가능
이때 hpa가 있따. horizontalpopautuscaler
이걸로 레플리카셋을 늘리다 말았따 한다.
hpa도 하나의 객체이다. 

서비스를 할 때는?
프런트엔드 파드를 두고,
중간에 서비스를 둔 다음 백엔드 파드들에 전달한다. 
서비스란 건 쿠버 안에서 동작하는 로드밸런서처럼 생각하면 된다.
파드 집합을 네트워크 상에서 안정적으로 추상화하는 객체이다.

사용자 흐름 생각해보자.
사용자가 클라 거쳐서 한 백엔드 파드로가보자.
그리고 로그인하면?
한 파드에는 세션에 남는데..
사용하다가 다른 파드로 가게 된다면!
문제 생긴다.
그래서 세션에 두지 말고 레디스나 memcached같은 달느 저장소에 둬야 한다. 

파드 단위의 네트워크가 있따. eth0.
그 안에도 네트워크가 있따. 공유 네트워킹 네임스페이스
그 안에서는 로컬호스트가 동작함

한 노드 안에서 파드가 두개일 때...
각 파드는 ip할당받는다.
노드의 넷인페로부터
한 파드가 받게 되는, 그 안에서 돌아가는 네트워크. 그걸 veth라 한다. 
노드의 nic와 veth 사이에 안 보이는 스위치가 있을 것이다.
이들은 노드 네트워킹 네임스페이스 상에서 통신할 것이다. 
이걸 브릿지 네트워크라고 부른다.

파드에는 두가지 넷이 있는 꼴이다.
파드 내에서, 그리고 노드 내에서.
더 위로 가면 클러스터 내에서의 넷도 있다..